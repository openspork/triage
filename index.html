<html>

<head>
    <title>Triage</title>
    <style>
        p {
            display: inline
        }
        #issue {
            display:none
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){

        $(".update").change(function(){
            var sum = 0

            var vip = ($("#vip").val() === 'true')
            var affected = $("#affected").val()
            var size = $("#size").val()
            var productivity = ($("#productivity").val() === 'true')
            var bizfunc = ($("#bizfunc").val() === 'true')
            var workaround = ($("#workaround").val() === 'true')
            var intermittent = ($("#intermittent").val() === 'true')
            var old = ($("#old").val() === 'true')

            // Calc percent affected
            percent = affected / size
            if (productivity) {
                if (percent >= .1 && percent < .3) {
                    if (sum < 20) {
                        var additional = 20 - sum
                        sum += additional
                    }
                    else {
                        sum += 5
                    }
                }
                else if (percent >= .3 && percent < .6 ) {
                    if (sum < 30) {
                        var additional = 30 - sum
                        sum += additional
                    }
                    else {
                        sum += 10
                    }
                }
                else if (percent >= .6) {
                    if (sum < 40) {
                        var additional = 40 - sum
                        sum += additional
                    }
                    else {
                        sum += 15
                    }
                }
            }
            else {
                if (percent >= .1 && percent <= .3) {
                    if (sum < 10) {
                        var additional = 10 - sum
                        sum += additional
                    }
                    else {
                        sum += 5
                    }
                }
                else if (percent > .3) {
                    if (sum < 15) {
                        var additional = 20 - sum
                        sum += additional
                    }
                    else {
                        sum += 10
                    }
                }
            }

            

            // Calc business impact
            if (bizfunc) {
                if (sum < 30) {
                    var additional = 30 - sum
                    sum += additional
                }
                else {
                    sum += 5
                }
            }
            // Calc VIP user
            if (vip) {
                if (sum < 30) {
                    var additional = 30 - sum
                    sum += additional
                }
                else {
                    sum += 10
                }
            }
            // Calc productivity impact (vs. informational)
            if (productivity) {
                $("#issue").show()

                if (sum < 20) {
                    var additional = 20 - sum
                    sum += additional
                }
                else {
                    sum += 5
                }
            }
            // Calc old issue
            if (old) { sum += 5 }

            // Discount workaround available
            if (workaround) { sum -= 5 }

            // Discount intermittent issue
            if (intermittent) { sum -= 5 }

            if (sum < 20) {
                $("body").css("background-color", "blue")
                $("body").css("color", "white")
                $("#resultval").text("Priority 4/5, your score is: " + sum)
            }
            if (sum >= 20 && sum < 30) {
                $("body").css("background-color", "yellow")
                $("body").css("color", "black")
                $("#resultval").text("Priority 3/5, your score is: " + sum)
            }
            if (sum >= 30 && sum < 40) {
                $("body").css("background-color", "orange")
                $("body").css("color", "black")
                $("#resultval").text("Priority 2/5, your score is: " + sum)
            }
            if (sum >= 40 ) {
                $("body").css("background-color", "red")
                $("body").css("color", "white")
                $("#resultval").text("Priority 1/5, your score is: " + sum)
            }
        });
    });

    </script>
</head>

<body>
    <div id="checklist">
        <p>
            Is the submitting user a VIP?
            <br>
            <select name="vip" id="vip" class="update">
                <option value="false">No</option>
                <option value="true">Yes</option>
            </select>
            <br><br>
            Is there an issue currently impacting productivity?
            <br>
            <select name="productivity" id="productivity" class="update">
                <option value="false">No</option>
                <option value="true">Yes</option>
            </select>
            <br><br>
            How many users are there at the company?
            <br>
            <input type="number" name="size" id="size" class="update"></input>
            <br><br>
            How many users are affected?
            <br>
            <input type="number" name="affected" id="affected" class="update"></input>
        </p>
        <p id="issue">
            <br><br>
            Is the issue intermittent?
            <br>
            <select name="intermittent" id="intermittent" class="update">
                <option value="false">No</option>
                <option value="true">Yes</option>
            </select>
            <br><br>
            Did the issue start more than one day ago?
            <br>
            <select name="old" id="old" class="update">
                <option value="false">No</option>
                <option value="true">Yes</option>
            </select>
            <br><br>
            Is a critical business function unable to be performed?
            <br>
            <select name="bizfunc" id="bizfunc" class="update">
                <option value="false">No</option>
                <option value="true">Yes</option>
            </select>
            <br><br>
            Is a workaround available:
            <br>
            <select name="workaround" id="workaround" class="update" data-weight=-7>
                <option value="false">No</option>
                <option value="true">Yes</option>
            </select>
        </p>
    </div>
    <div id="result">
        <p id="resultval"></p>
    </div>
</body>

</html>